<!DOCTYPE html>
<html class="mkdocs-jwplayer ">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced Features - iOS Developer Guide</title>

    
      <meta name="robots" content="noindex, follow">
    

    
      <meta name="description" content="JW Developers provides tools and resources for developers using JW Player, JW Platform and the Android and iOS SDKs." />
    

    
      <link rel="shortcut icon" href="../../img/favicon.ico">
    

    <link rel="stylesheet" href="../../css/mkdocs-jwplayer.min.css">

    

    
    

    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MBF9PW"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MBF9PW');</script>

  </head>
  <body>
    <div class="site">

				<div class="site-top">
	        <!--Start Common Site Header-->
<div class="site-header">
  <div class="site-header-container">
    <a class="logo" href="/">
      <img src="//developer.jwplayer.com/img/jw-logo-mark-white.svg">
      <img src="//developer.jwplayer.com/img/jw-logo-text-white.svg">
      <span class="developer">Developer</span>
    </a>
    <a class="menu-toggle" href="#">Menu</a>
    <ul class="menu">
      <li><a class="link" href="https://www.jwplayer.com">Company</a></li>
      <li><a class="link" href="https://www.jwplayer.com/blog">Blog</a></li>
      <li><a class="link" href="https://support.jwplayer.com">Support</a></li>
      <li><a class="link" href="https://dashboard.jwplayer.com">Sign-In</a></li>
      <li><a class="link" href="/search/"><img class="search-icon" src="//icons.jwplayer.com/icons/white/search.svg" width="15" /></a></li>
      <li><a class="btn md red" href="https://www.jwplayer.com/pricing/?utm_source=developer&utm_medium=CTA&utm_campaign=Developer%20Nav%20Upgrade">Get Started</a></li>
    </ul>
  </div>
</div>
<!--End Common Site Header-->
	        <div class="site-secondary-header">
  <div class="site-secondary-header-container">
    <div class="site-secondary-header-group">
      <div class="site-secondary-header-dropdown">
        <a class="site-secondary-header-dropdown-arrow" href="#"></a>
        <a href="/jw-player/" class="site-secondary-header-dropdown-link ">JW Player</a>
        <a href="/jw-platform/" class="site-secondary-header-dropdown-link ">JW Platform</a>
        <a href="/android-sdk/" class="site-secondary-header-dropdown-link ">Android SDK</a>
        <a href="/ios-sdk/" class="site-secondary-header-dropdown-link is-selected">iOS SDK</a>
      </div>
    </div>
    
    
    
    
      <a href="/sdk/ios/reference/">API Reference</a>
      <a href="/sdk/ios/docs/developer-guide/">Developer Guide</a>
      <a href="/ios-sdk/demos/">Best Practice Apps</a>
      <a href="/sdk/ios/docs/developer-guide/about/release-notes/">Release Notes</a>
    
  </div>
</div>
	        <div class="page-header">
	<div class="page-label">
		
			Advanced Features
		
	</div>
	<form class="search" action="./../../search.html" method="get">
		<input type="search" name="q" placeholder="Search documentation..." />
	</form>
</div>
				</div>

        <div class="site-bottom">

					<div class="site-body">

	          <div class="page">

	            <div class="page-body">

	              <div class="scroll-to-top">
	<img src="//icons.jwplayer.com/icons/white/change-arrow-up.svg">
</div>

	              <div class="aside">
									
										<ul>
											
		                    
  <li>
    
      <span>Welcome</span>
    
    <ul>
      
        
  <li >
    <a href="../..">Introduction</a>
  </li>

      
        
  <li >
    <a href="../../2x-redirect/">2.x Documentation</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Get Started</span>
    
    <ul>
      
        
  <li >
    <a href="../../intro/requirements/">System Requirements</a>
  </li>

      
        
  <li >
    <a href="../../intro/getting-started/">Library and Project Setup</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Create a JW Player</span>
    
    <ul>
      
        
  <li >
    <a href="../embedding/">Basic Embedding</a>
  </li>

      
        
  <li class="active">
    <a href="./">Advanced Features</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Interact with JW Player</span>
    
    <ul>
      
        
  <li >
    <a href="../../api/classes/">Classes</a>
  </li>

      
        
  <li >
    <a href="../../api/callbacks/">Callbacks</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Customize</span>
    
    <ul>
      
        
  <li >
    <a href="../../customization/building-skins/">Custom Skins</a>
  </li>

      
        
  <li >
    <a href="../../customization/captions/">Captions</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Casting</span>
    
    <ul>
      
        
  <li >
    <a href="../../casting/airplay/">AirPlay</a>
  </li>

      
        
  <li >
    <a href="../../casting/chromecast/">Chromecast</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Ads</span>
    
    <ul>
      
        
  <li >
    <a href="../../monetization/ad-configuration/">Basic Ad Embed</a>
  </li>

      
        
  <li >
    <a href="../../monetization/ad-schedules/">Ad Scheduling</a>
  </li>

      
        
  <li >
    <a href="../../monetization/ad-waterfall/">Tag Waterfall</a>
  </li>

      
        
  <li >
    <a href="../../monetization/ad-tag-variables/">Ad tag variables</a>
  </li>

      
        
  <li >
    <a href="../../monetization/nonlinear-ads/">Non linear ads</a>
  </li>

      
        
  <li >
    <a href="../../monetization/ad-google_ima/">Google IMA</a>
  </li>

      
        
  <li >
    <a href="../../monetization/freewheel/">FreeWheel</a>
  </li>

      
        
  <li >
    <a href="../../monetization/ad-rules/">Ad Rules</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Migration</span>
    
    <ul>
      
        
  <li >
    <a href="../../migration/v3/">To 3.x from 2.x</a>
  </li>

      
        
  <li >
    <a href="../../migration/v2dot8/">To 2.8.0 from 2.7.x</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>3rd Party Integration</span>
    
    <ul>
      
        
  <li >
    <a href="../../integration/analytics/">Analytics</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>Troubleshooting</span>
    
    <ul>
      
        
  <li >
    <a href="../../troubleshooting/troubleshooting/">Q&A</a>
  </li>

      
    </ul>
  </li>

		                  
		                    
  <li>
    
      <span>About</span>
    
    <ul>
      
        
  <li >
    <a href="../../about/license/">License</a>
  </li>

      
        
  <li >
    <a href="../../about/release-notes/">Release Notes</a>
  </li>

      
    </ul>
  </li>

		                  
										</ul>
							    
	              </div>

	              <div class="main">
	                
	                  <h1 id="advanced-features">Advanced Features</h1>
<h2 id="dvr">DVR</h2>
<p>DVR functionality allows viewers to pause, play, and rewind live events. If viewers begin watching an event past the initial broadcast time, and do not want to miss any important content, this allows them to start at an earlier position. If DVR is supported and enabled on the streaming server, add "?DVR" to the video url (eg. http://mydomain.com/video.m3u8?DVR) to indicate to the player that the HLS Playlist is a DVR stream. JW Player will in turn adjust the visual elements on the control bar to support DVR and make it clear to the viewer that the live stream can be paused or rewound to a point in the past.</p>
<h2 id="background-audio">Background Audio</h2>
<p>If you have not enabled the "Audio, AirPlay and Picture in Picture" setting in the Background Modes of your project's capabilities list, add the UIBackgroundModes key in your app's Info.plist and set its value to an array containing the string "audio". Import the AVFoundation framework and add the following code to your app:</p>
<pre><code>AVAudioSession *audioSession = [AVAudioSession sharedInstance];

NSError *setCategoryError = nil;
BOOL success = [audioSession setCategory:AVAudioSessionCategoryPlayback error:&amp;setCategoryError];

NSError *activationError = nil;
success = [audioSession setActive:YES error:&amp;activationError];
</code></pre>
<p>In a Swift based project, please follow these steps to achieve the background audio capability:</p>
<p>Step 1- Add a key in your Info.plist called 'Required background modes'. Under this key, add a value called 'App plays audio or streams audio/video using AirPlay'.
Step 2- In your AppDelegate, import AVFoundation
Step 3- In your didFinishLaunchingWithOptions method add this:
    do
        { try AVAudioSession.sharedInstance().setCategory(AVAudioSessionCategoryPlayback) }
    catch
        { print("error coming back from background") }</p>
<p>Note: Per <a href="https://developer.apple.com/library/ios/qa/qa1668/_index.html">Apple's documentation</a>, adding the audio string to the UIBackgroundModes array in your Info.plist will also enable streaming via AirPlay.</p>
<h2 id="lock-screen-controls">Lock Screen Controls</h2>
<p>An application reproducing content with JW Player will display controls on the device's lockscreen by default as long as background audio is enabled.
<em> Play/Pause will always be displayed, and can be toggled with the Apple EarPod headphones.
</em> Previous and next will appear greyed out when playing single items and ads.
<em> Previous will be greyed out for the first item of a playlist.
</em> Next will <strong>Not</strong> be greyed out for the last item of a playlist; tapping next will load the first item of the playlist.</p>
<p>Additionally, information about the content being reproduced will be displayed:
<em> Information set to a JWPlaylistItem (title and image) will be displayed.
</em> If absent from the JWPlaylistItem, respective information from the JWConfig will be displayed. 
<em> If a title is not specified, the name of the application will be displayed as a title.
</em> When Google IMA ads are in reproduction, the title switches to "Advertisement".</p>
<p>If you wish to disable this feature and/or override it with your own settings, set the JWPlayerController's displayLockScreenControls property to NO.</p>
<p>Note: In order for Lock Screen controls to appear, the audioSession's categoryOptions property must include AVAudioSessionCategoryOptionDefaultToSpeaker or AVAudioSessionCategoryOptionAllowBluetooth, or return 0.</p>
<h2 id="custom-asset-options">Custom asset options</h2>
<p>When initializing the player, an options dictionary for AVURLAsset customization can be specified, via the <code>assetOptions</code> property in JWConfig, JWSources or JWPlaylistItem.</p>
<p>The AVURLAsset customization options are described in <a href="https://developer.apple.com/library/mac/documentation/AVFoundation/Reference/AVURLAsset_Class/#//apple_ref/doc/constant_group/Initialization_Options">AVURLAsset documentation</a>.</p>
<p>For example:</p>
<pre><code>JWConfig *config = [[JWConfig alloc] initWithContentUrl:@"your url"];
config.assetOptions = @{@"AVURLAssetHTTPHeaderFieldsKey":@{@"cookie": @"cookie data"}};
</code></pre>
<h2 id="drm">DRM</h2>
<h3 id="apple-fairplay">Apple FairPlay</h3>
<h4 id="overview">Overview</h4>
<p>FairPlay Streaming (FPS) securely delivers keys to Apple mobile devices, enabling the playback of encrypted video content. FPS allows a content provider to securely deliver an AES 128-bit content key from the provider&rsquo;s key server. The content provider encrypts the H.264 video content with the content key. Then, FPS decrypts the encrypted video content with the content key. </p>
<p>The JW Player SDK does not encrypt streams for you, and does not implement a key server. The JW Player SDK detects when a stream is FairPlay encrypted and asks your app to provide the necessary information and key to decrypt the content. This approach gives you the flexibility to encrypt your content and manage your keys the way you prefer.</p>
<p>In order for you to be FPS compliant you must:</p>
<ul>
<li>Write a Key Security Module that is installed in a key server's software. </li>
<li>Add code to allow your app to communicate with the server that can deliver the key needed to decrypt the content.</li>
<li>Create the formatting and encryption software for the media content server. This software prepares the encrypted content stream according to the Apple HTTP Live Streaming (HLS) specification.</li>
</ul>
<p>For more information on being FPS compliant, please refer to <a href="https://developer.apple.com/streaming/fps/">Apple's FairPlay documentation</a>.</p>
<h4 id="implementation">Implementation</h4>
<p>In order to play FairPlay encrypted HLS, the class in your app which communicates with your FairPlay Key Server must adhere to the JWDrmDataSource protocol and be set to the JWPlayerController's drmDataSource property.</p>
<p> <pre><code class>    self.player.drmDataSource = self;
</code></pre></p>
<p>When an FPS-specific tag is included in the playlist of a media stream that the Apple device is asked to play, the JW Player SDK will ask your application for the necessary information to prepare an encrypted key request:
* the fetchContentIdentifierForRequest: delegate method gets called, requesting that the content identifier (also known as Asset ID) be passed in through its completion block.</p>
<p> <pre><code class>    - (void)fetchContentIdentifierForRequest:(NSURL *)loadingRequestURL forEncryption:(JWEncryption)encryption withCompletion:(void (^)(NSData *))completion
    {
        if(encryption == JWFairPlay) {
            NSString *assetId; // obtain asset Id here.
            NSData *assetIdData = [NSData dataWithBytes:[assetId cStringUsingEncoding:NSUTF8StringEncoding] length:[assetId lengthOfBytesUsingEncoding:NSUTF8StringEncoding]];
            completion(assetIdData);
        }
    }
</code></pre></p>
<ul>
<li>the fetchAppIdentifierForRequest: delegate method is called, prompting for an Application Certificate which must get passed via the completion block. The Application Certificate must be encoded with the X.509 standard with distinguished encoding rules (DER). It is obtained when registering an FPS playback app with Apple, by supplying an X.509 Certificate Signing Request linked to your private key.</li>
</ul>
<p> <pre><code class>    - (void)fetchAppIdentifierForRequest:(NSURL *)loadingRequestURL forEncryption:(JWEncryption)encryption withCompletion:(void (^)(NSData *))completion
    {
        if(encryption == JWFairPlay) {
            NSData *applicationId; // obtain application Id here.
            completion(applicationId);
        }
    }
</code></pre></p>
<p>When the key request is ready:
* the fetchContentKeyWithRequest: delegate method is called, providing you with the key request data (also known as SPC - Server Playback Context message) which you need to retrieve the CKC (Content Key Context) message from your key server. The CKC message must be returned via the completion block, under the response parameter. When your app sends the request to the server, the FPS code on the server wraps the required key in an encrypted message and sends it to the app. Your app then provides the JW Player SDK with the encrypted message, which is used to unwrap the message and decrypt the stream, so the iOS device can play the media. 
        * For resources that may expire, you can specify a renewal date in the completion block.
        * We suggest also specifying the content type (the UTI indicating the type of data contained by the response) when a renewal date is set.</p>
<p> <pre><code class>    - (void)fetchContentKeyWithRequest:(NSData *)requestBytes forEncryption:(JWEncryption)encryption withCompletion:(void (^)(NSData *, NSDate *, NSString *))completion
    {
        if(encryption == JWFairPlay) {
            NSData *key = [self.serverLink keyFromRequest:requestBytes]; // obtain key here from server by providing the request.
            NSDate *renewalDate; // (optional)
            NSString *contentType = @&quot;application/octet-stream&quot;; // (optional)
            completion(key, renewalDate, contentType);
        } 
    }
</code></pre></p>
<p>Note: FairPlay decryption only works on devices; it will not work on a simulator.</p>
	                
	                
	                  <div class="pagination prev-next">
                      
   	                      <a class="btn md" href="../embedding/" title="Basic Embedding">Previous Page</a>
   	                    
	                    
	                      <a class="btn md" href="../../api/classes/" title="Classes"/>Next Page</a>
	                    
	                  </div>
	                
	              </div>

	            </div>

	          </div>
	        </div>

	        <!--Start Common Site Footer-->
<footer class="global-site-footer">
  <div class="global-site-footer-container">
    <div class="product-links-row">
      <div class="product-link-block">
        <a href="//www.jwplayer.com">
          <div class="product">JW Player</div>
          <div class="description">Browse our products, company, resources, and pricing</div>
        </a>
      </div>
      <div class="product-link-block">
        <a href="//dashboard.jwplayer.com">
          <div class="product">Dashboard</div>
          <div class="description">Content, players, analytics, and account management</div>
        </a>
      </div>
      <div class="product-link-block">
        <a href="//developer.jwplayer.com">
          <div class="product">Developer</div>
          <div class="description">Join the community, demos, references, dev guides, and tools.</div>
        </a>
      </div>
      <div class="product-link-block">
        <a href="//support.jwplayer.com">
          <div class="product">Support</div>
          <div class="description">Search the articles, ask the community, or give feedback</div>
        </a>
      </div>
    </div>
  </div>
  <div class="footer-base-row">
    <div class="copyright">
      &copy; 2016 - <script>document.write(new Date().getFullYear())</script> | Longtail Ad Solutions, Inc. All Rights Reserved. JW Player is a registered trademark.
    </div>
    <div class="footer-links">
      <a href="//www.jwplayer.com/careers/">Careers</a>
      <a href="//www.jwplayer.com/tos/">Terms of Service</a>
      <a href="//www.jwplayer.com/privacy/">Privacy Policy</a>
      <a href="//www.jwplayer.com/dmca/">DMCA</a>
      <a href="//www.jwplayer.com/privacy/#ad-choices">Ad Choices</a>
    </div>
  </div>
</footer>
<!--End Common Site Footer-->

        </div>

    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="../../js/mkdocs-jwplayer.min.js"></script>

    
      <script src="../../search/main.js"></script>
    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.js"></script>
    <script>
      window.onload = (function(){ prettyPrint(); });
    </script>
  </body>
</html>